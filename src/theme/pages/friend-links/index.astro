---
import BaseLayout from '../../layouts/BaseLayout.astro'
import { config } from '../../consts'
import { isValidHttpUrl } from '../../utils/is-valid-http-url'
import { getOriginalImageId } from '../../utils/thumbnail'
import UnionImage from '../../components/astro/UnionImage.astro'

const friends = await Promise.all(
	config.friends?.map(async (f) => {
		if (isValidHttpUrl(f.avatar.url)) {
			return f
		}
		const slug = await getOriginalImageId(f.avatar.url)
		const avatarUrl = '/avatar/' + slug
		return {
			...f,
			avatar: {
				...f.avatar,
				url: avatarUrl,
			},
		}
	}) ?? [],
)
---

<BaseLayout showAuthorInfo>
	<div class="sm:columns-2 lg:columns-3 2xl:columns-4 col-gap-4">
		{
			config.friends?.map((f) => (
				<a
					href={f.url}
					target="_blank"
					class="block break-inside-avoid mb-2 sm:mb-4"
				>
					<div class="glassmorphism p-4 flex flex-col gap-4 rounded-md">
						<div class="flex items-center gap-4">
							<UnionImage {...f.avatar} imageClass="size-[3rem] rounded-full" />
							<p class="truncate">{f.name}</p>
						</div>
						{f.description && <p class="break-all">{f.description}</p>}
					</div>
				</a>
			))
		}
	</div>
</BaseLayout>
